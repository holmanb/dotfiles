#!/bin/zsh

SCRIPTPATH=$0:A:h
F="$SCRIPTPATH/files"

function setpath(){
    set -e
    set -x
    (cd "$F" && "$1" "$@")
}

function files(){
    install compe-config.lua    ~/.config/nvim/lua/
    install lsp-keybinds.lua	~/.config/nvim/lua
    install init.vim            ~/.config/nvim/
    install .vimrc              ~/
    install .ctags              ~/
    install .bashrc             ~/
    install .zshrc              ~/
}

function apps(){
    npm config set prefix "$HOME/.npm-packages"
    npm i -g pyright
    npm i -g bash-language-server
    npm i -g vim-language-server
    npm i -g clangd
    GO111MODULE=on go get golang.org/x/tools/gopls@latest
    curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
        https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
    (git clone https://github.com/rust-analyzer/rust-analyzer.git && cd rust-analyzer && cargo xtask install --server)
}

function dir(){
    mkdir -p ~/.config/nvim/plugged
    mkdir -p ~/.config/nvim/lua
    mkdir -p ~/.vim
    echo $NPM_PACKAGES/bin
    mkdir -p $NPM_PACKAGES/bin # from .zshrc
}

function __push(){
    dir
    files
}

function __install(){
    dir
    apps
    files
    nvim +PlugInstall
}

function __pull(){
    install ~/.config/nvim/*.vim .
    install ~/.config/nvim/lua/*.lua .
    install ~/.vimrc .
    install ~/.zshrc .
    install ~/.bashrc .
    install ~/.ctags .
}

function __git(){
    "$@"
}

([ "$1" = push ] || [ "$1" = pull ] || [ "$1" = install ]) && setpath "__$1" && exit 0

# Convenient way to interact with git repo regardless of cwd
[ "$1" = git ] && setpath "__$1" "$@" && exit 0

echo
echo "usage: $0 [push|pull]"
echo
echo "push/pull registered files between a git repo and filesystem locations"
echo
echo "git <cmd> - run vcs commands as cwd is in the repo directory"
echo "install   - deploy files from vcs directory and install deps"
echo "push      - deploy files from vcs directory"
echo "pull      - move files to vcs directory"
echo
